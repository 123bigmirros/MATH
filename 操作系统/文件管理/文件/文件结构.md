### 文件结构  

**逻辑结构**  
从用户观点出发看到的文件的组织形式。  
- 无结构结构文件  
无结构文件将数据按顺序组织成记录并积累、保存，他是有序相关信息项的集合，记录访问只能通过穷举搜索，以字节为单位。适合源程序文件、目标代码文件

- 有结构文件  
    1. 顺序文件  
    文件中的记录一个接一个顺序排列，记录通常是定长的，可以采用顺序存储或链表形式存储。 

    顺序文件有两种结构  
        1. 串结构  
        记录之间的顺序与关键字无关，通常按存入时间先后排序。  
        2. 顺序结构  
        所有记录按关键字进行排序，可采用折半查找    
    2. 索引文件  
    为文件建立一张索引表，为文件中的每个记录在索引表中设置表项(包含指向变长记录的指针和记录长度)，索引表按关键字排序。  

    3. 索引顺序文件  
    将顺序文件和索引文件结合。  
    先将顺序文件中的文件分为若干组，为这些组建立索引表，为每组第一条记录建立一个索引项。  
    为提高查找效率，可采用多级索引。  

    4. 直接文件或散列文件  
    通过记录的键值或通过散列函数转换的键值直接决定记录的物理地址。


**物理结构**  
主要包括文件的分配方式(磁盘非空闲块的管理方式)，文件存储空间管(磁盘空闲块管理)  
- 文件分配方式  
  1. 连续分配  
  要求文件在磁盘上占用一组连续的块。  
     - 优点  
      实现简单，存取速度快，支持顺序访问和直接访问。
      
       
     - 缺点  
       1. 文件长度不宜动态增加
       2. 删除和插入性能损耗大
       3. 产生大量外部碎片  
  2. 链接分配  
  采用离散分配放入公司年会的hi。消除了磁盘的外部碎片，提高磁盘的利用率  
       - 隐式链接  
       目录项中含有文件的第一块指针和最后一块指针。每个文件对应一个磁盘块链表，除最后一个盘块外，每个盘块都含有指向下一个盘块的指针。  
           - 缺点  
           只适合顺序访问，链表中某一指针的丢失或损坏，会导致后边数据的全部丢失。  
           解决方案是将几个盘块组成簇，按簇不按块来分配，减少查找时间和指针数量，但增加了内部碎片。  

       - 显式链接  
       将链接各物理块的指针提取，显式的存放在内存的一张表中。  
       该表在磁盘中仅设置一张，称为文件分配表(FAT,每个表项存放链接指针，即下个磁盘块好。)  
       FAT不仅记录文件的先后链接关系，还标记了空闲的磁盘块。  
       FAT在启动时就被读入内存。  
         - 缺点  
           1. 不支持直接访问
           2. FAT占用的空间较大
    3.  索引分配  
    索引分配把每个文件所有的盘块号都放在一起组成索引块(可以认为是磁盘块地址的数组)。   
    支持直接访问文件的某一块，且没有外部碎片问题。但增加了系统存储空间的开销。  
      - 支持大文件方式  
        1. 链接方案  
        一个索引块通常为一个磁盘块，可通过链表方式链接多个索引块来支持大文件  
        1. 多层索引  
        通过将索引块分级，第一级索引块存放第二级索引块所在的磁盘块号。第二级可以存放文件真正的磁盘块号或者下一级索引块  
        1. 混合索引  
        多种索引方式相结合。  
          - Unix实现  
          将FCB中13个索引项分为直接地址、一次间接地址、多次间接地址来实现混合索引。  
            - 直接地址  
            用i.addr(0)~i.addr(9)存放直接地址，存放最后一级索引块，直接定位文件的磁盘块号。  
            - 一次间接地址  
            使用i.addr(10)来存放以及间接地址，通过改地址来寻找下一级索引块。  
            - 多次间接索引  
            使用i.addr(11)提供二次间接索引块地址 。  
            使用i.addr(12)提供三级间接索引块地址 。

- 空闲空间管理  
卷(分区)在提供文件服务前，必须由对应的文件程序进行初始化，划分好目录区和文件区，建立空闲空间管理表格以存放卷信息的超级块。  
文件存储设备分成许多大小相同的物理块，并以块为单位交换信息。  
分配方法有  
  1. 空闲表法  
  系统为外存上所有空闲区建立一张空闲盘块表，每个空闲区对应于一个空闲表项，其中包括表项序号、空闲区的第一个块盘号、该区的空闲盘块数等信息。  
  所有空闲区按其实盘块号递增的次序排列。    
  分配方式是连续分配，分配方法有首次适应法和最佳适应算法。  
  回收时要考虑相邻盘块的合并问题。  
  2. 空闲链表法  
  将所有空闲盘拉成一条空闲链。  
  根据构成链所用基本元素的不同，分为空闲盘块链和空闲盘区链。  
  - 空间盘块链  
  以盘块为单位拉成一条链。  
  需要空间是从链首依次取下分配。  
  回收时将盘块插入链表尾部。  
    - 特点  
    实现简单，但为一个文件分配时要重复操作多次。  
  - 空闲盘区链。  
  将所有空闲盘区(一个盘区对应若干盘块)拉成一条链。每个盘区的内容除了下个盘区的指针，还应能指明本盘区的大小。  
  采用首次适应算法。  
  回收时要考虑与相邻盘区的合并。  
    - 特点  
    回收过程复杂，但效率较高，且空闲盘区较短。  
  3. 位示图法  
  利用二进制的一位来表示盘块使用状况。1位已使用，0位空闲。  
  4. 成组链接法  
  结合空闲表和空闲链表。通过分级表的方法寻址。  
  将顺序的n个空闲盘块号保存在一个成组链块(存放一组空闲盘块号)中，最后一个空闲盘块号指向保存另一组空闲盘块的成组链块。  
    - 盘块分配和回收  

  

  