### 异常和中断机制  
CPU的数据通路中有异常检测和响应逻辑，外设接口中有相应的中断请求和控制逻辑，操作系统中有相应的中断服务程序  


**异常和中断基本概念**  
CPU内部产生的叫中断，外部部件触发与当前指令无关的异步事件  

**异常和中断分类**  
- 异常分类
异常由CPU内部产生的意外事件，分为硬故障中断和程序性异常。
    1. 故障  
    指在引起故障的指令启动后、指令结束前被检测到的异常事件。例如出现非法操作数、缺页、缺段、除0等操作
    2. 自陷  
    主动的进入中断  
    3. 终止  
    执行指令的过程中发现了使计算机无法使用的硬件故障  

    故障和自陷属于程序型异常。终止异常和外中断属于硬件异常。
- 中断分类  
    1. 可屏蔽中断  
    2. 不可屏蔽中断

**中断主要功能**  
- 实现CPU与I/O设备的并行工作
- 处理硬件故障和软件故障
- 实现人机交互
- 实现多道程序
- 实现实时处理程序
- 实现内核态和用户态切换
- 多处理系统中个处理器之间的信息交流和任务切换


**异常和中断的响应过程**  
1. 关中断
2. 保存编程断点和程序状态  
3. 识别异常和中断并转到相应的处理程序  
识别有软件识别和硬件识别。  
    - 软件识别  
    CPU设置一个异常状态寄存器，记录异常原因。操作系统用一个统一的异常或中断查询程序，按优先级顺序查询异常状态存储器  
    - 硬件识别  
    又称向量中断，异常或中断处理程序的首地址成为中断向量，所有中断向量都放在中断向量表中，异常或中断指定中断类型号，可以在中断向量表中快速找到对应的中断处理程序
4. 保存现场和屏蔽字
5. 开中断
6. 执行中断服务程序
7. 关中断
8. 恢复线程和屏蔽字
9. 开中断、中断返回